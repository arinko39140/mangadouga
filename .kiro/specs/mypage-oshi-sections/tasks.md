# Implementation Plan

- [ ] 1. データ層と可視性の基盤を整える
- [ ] 1.1 profile_visibilityの真値化と初期データ整備
  - Supabaseに可視性テーブルとRLSを整備し、可視性フラグのみを安全に参照できる状態にする
  - 既存ユーザーの可視性初期値をバックフィルし、公開/非公開の既定値が一貫するようにする
  - 新規ユーザー作成時に可視性レコードが自動作成されるようにする
  - _Requirements: 4.7, 4.8_

- [ ] 1.2 ProfileVisibilityProviderで可視性取得とフェイルセーフを実装する
  - 可視性取得はprofile_visibilityのみを参照し、他のデータソースを使わない
  - 可視性未設定や取得失敗時は安全側としてprivate扱いで返す
  - 取得結果をセクション単位のpublic/private判定に使える形で提供する
  - _Requirements: 4.1, 4.4, 4.7, 4.8_

- [ ] 1.3 (P) UserOshiListProviderのサマリー取得を整備する
  - 本人/他ユーザーの閲覧文脈に応じて公開データのみ返す
  - ユーザー未存在や取得失敗の状態を一貫したステータスで返す
  - 空状態の判定に必要な情報を返す
  - _Requirements: 2.1, 3.1, 4.1, 4.4_

- [ ] 1.4 (P) UserSeriesProviderのサマリー・一覧・管理操作を整備する
  - サマリーは新着順で最大3件に制限する
  - 一覧取得でseriesの主要情報と代表サムネイルを統合して返す
  - 登録/解除は本人のみ実行できるように制御する
  - 並べ替えはお気に入り数の昇順/降順に対応する
  - _Requirements: 2.2, 2.4, 8.1, 8.2, 8.3, 9.1, 9.2, 9.3, 9.4_

- [ ] 1.5 (P) OshiFavoritesProviderのサマリーと一覧取得を整備する
  - 本人のみ取得できる前提で推しリスト情報を返す
  - サマリーは最大3件程度に制限する
  - _Requirements: 2.3, 6.2_

- [ ] 2. マイページの推しセクションUIを構築する
- [ ] 2.1 UserOshiSectionsで順序・可視性・表示条件を統合する
  - 推しリスト→推し作品→お気に入り推しリストの順序を固定する
  - 他ユーザー閲覧時はprofile_visibilityに従って公開/非公開を判定する
  - 非公開セクションは見出しのみ表示し、内容は非公開文言を出す
  - お気に入り推しリストは本人のみ表示し、他ユーザー閲覧時は非表示にする
  - _Requirements: 1.1, 1.3, 1.4, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8_

- [ ] 2.2 UserOshiListPanelで推しリスト概要と導線を表示する
  - セクション見出しを表示し、項目名と導線を提示する
  - 空状態の場合は該当セクションで空状態文言を表示する
  - 非公開時は内容の表示を行わず、非公開である旨を表示する
  - 件数表示は必須にせず、必要な場合のみ表示する
  - _Requirements: 1.2, 2.1, 2.5, 2.6, 3.1, 3.4, 4.2, 4.3, 7.1_

- [ ] 2.3 UserOshiSeriesPanelで推し作品サマリーと導線を表示する
  - セクション見出しを表示し、作品名を含むサマリーを表示する
  - 新着順で最大3件程度の推し作品を表示する
  - 推し作品ページへの導線を表示する
  - 空状態の場合は該当セクションで空状態文言を表示する
  - 非公開時は内容の表示を行わず、非公開である旨を表示する
  - _Requirements: 1.2, 2.2, 2.4, 2.5, 3.2, 3.4, 4.2, 4.3, 5.1, 5.2, 8.4, 8.5_

- [ ] 2.4 UserOshiFavoritesPanelでお気に入り推しリスト概要と導線を表示する
  - セクション見出しを表示し、本人閲覧時のみサマリーと導線を表示する
  - 空状態の場合は該当セクションで空状態文言を表示する
  - 他ユーザー閲覧時はセクション自体を表示しない
  - _Requirements: 1.2, 2.3, 3.3, 3.4, 6.1, 6.3_

- [ ] 2.5 UserPageの認証必須導線とデータ取得を整える
  - 未ログイン時はマイページ内容を表示せずログイン導線を提示する
  - ログイン済みの場合にのみ推しセクションの取得・表示を行う
  - 本人閲覧時のみお気に入り推しリストの取得を行う
  - _Requirements: 0.1, 0.3, 1.1, 4.4_

- [ ] 3. 推し作品ページの一覧と管理UIを構築する
- [ ] 3.1 UserOshiSeriesPageの認証必須と非公開表示を整える
  - 未ログイン時はログイン導線へ誘導する
  - 他ユーザー閲覧時はprofile_visibilityに従って非公開表示を行う
  - 非公開時は一覧取得を行わず非公開文言のみを表示する
  - _Requirements: 0.2, 4.1, 4.2, 4.3, 4.7, 4.8_

- [ ] 3.2 推し作品ページの一覧表示と表示形式切替を実装する
  - user_seriesとseriesの情報を統合した一覧を表示する
  - 作品の主要情報と代表サムネイルを表示する
  - 作品ページへの導線を表示する
  - 表示形式の切り替えを提供する
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6_

- [ ] 3.3 推し作品ページの登録/解除/並べ替え操作を実装する
  - 登録操作でuser_seriesへ反映される
  - 解除操作でuser_seriesから削除される
  - お気に入り数の昇順/降順で並べ替えができる
  - _Requirements: 9.1, 9.2, 9.3, 9.4_

- [ ] 4. お気に入り推しリスト専用ページを整備する
- [ ] 4.1 OshiFavoritesPageで本人専用の一覧表示を提供する
  - 未ログイン時はログイン導線へ誘導する
  - 本人の推しリストをグリッド形式で表示する
  - 読み込み中・空状態・エラーを適切に表示する
  - _Requirements: 6.2_

- [ ] 5. 統合とテストで要件充足を確認する
- [ ] 5.1 セクション遷移と非公開/空状態の統合動作を確認する
  - マイページ各セクションから対象ページへ迷わず遷移できる
  - 非公開セクションは見出しのみ表示され、他セクションへ影響しない
  - 未ログイン時は各ページがログイン導線へ誘導される
  - _Requirements: 0.1, 0.2, 0.3, 4.2, 4.5, 5.1, 5.2, 6.1, 6.3, 7.1_

- [ ] 5.2 主要シナリオの単体・結合・UIテストを追加する
  - セクション順序と表示条件（本人/他者・公開/非公開）を検証する
  - 推し作品サマリーの件数制限と並べ替えが機能することを確認する
  - 推し作品ページの一覧表示と操作、推しリスト専用ページのグリッド表示を検証する
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 2.4, 3.1, 3.2, 6.2, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 9.1, 9.2, 9.3, 9.4_
