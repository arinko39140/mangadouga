# Implementation Plan

- [ ] 1. データ取得プロバイダを実装する
- [x] 1.1 (P) ユーザー情報と外部リンクの取得ロジックを整備する
  - ユーザーIDが空の場合は無効入力として扱い、画面側で即時エラーにできる結果を返す
  - ユーザーが存在しない場合は「存在しない」状態として返し、ページ全体エラーの判定に使えるようにする
  - 外部リンクは`http`/`https`のみ有効とし、無効URLは結果から除外する
  - ドメインでX/YouTube/その他を分類し、表示名は有効URLがある場合のみ付与する
  - 再表示時に最新データが取得できるよう、キャッシュ前提の挙動を避ける
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 3.9, 9.1, 9.2_

- [x] 1.2 (P) 推しリスト概要と公開状態の取得ロジックを整備する
  - 対象ユーザーの推しリスト有無と公開/非公開を判定し、状態を返せるようにする
  - 非公開時は内容とお気に入り数を返さず、非公開メッセージ表示に必要な情報だけ返す
  - 推しリスト未作成時は空状態として扱える結果を返す
  - 読み込み中・失敗時を区別できる結果を返し、UIで空状態とエラーを分けられるようにする
  - 再表示時にお気に入り状態を含めた最新データを取得できるようにする
  - _Requirements: 2.1, 2.3, 2.5, 6.1, 6.2, 6.3, 6.4, 7.5, 9.1, 9.4_

- [x] 1.3 (P) 推し作品（シリーズ）一覧の取得ロジックを整備する
  - 対象ユーザーの公開可能なシリーズのみ取得し、非公開の作品は除外する
  - タイトルやシリーズIDが欠損している項目は表示対象から除外する
  - 読み込み中・空状態・失敗状態を区別できる結果を返す
  - 再表示時に最新データを取得できるようにする
  - _Requirements: 2.2, 2.4, 2.5, 5.1, 5.2, 5.3, 5.4, 9.1, 9.4_

- [x] 1.4 (P) 推しリストのお気に入り登録操作を提供する
  - ログイン必須の前提で操作できるようにし、未ログイン時は操作不可として扱う
  - リストが非公開またはリストIDがない場合は操作を無効化し、無効入力として扱う
  - 登録/解除の結果を受けてお気に入り状態を即時に反映できるようにする
  - 失敗時は状態を更新せず、エラー表示のトリガーになる結果を返す
  - _Requirements: 7.1, 7.2, 7.3, 7.4_

- [ ] 2. ユーザー情報と外部リンクのUIパネルを実装する
- [x] 2.1 (P) ユーザー情報パネルを整備する
  - ユーザー名と見出しを表示し、読み込み中の状態も明示する
  - ユーザーアイコンがある場合は円形で表示し、未設定時は空状態を表示する
  - 画像形式の制約に沿った表示を行い、破損時は代替表示に切り替える
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7_

- [x] 2.2 (P) 外部リンクパネルを整備する
  - 有効なリンクのみ一覧表示し、表示名がある場合は表示名を優先表示する
  - X/YouTube/その他のカテゴリ表示を行い、リンクはクリック可能にする
  - 新規タブで開く挙動と`rel`属性を必須化する
  - 外部リンクが0件の場合は空状態を表示する
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 3.9_

- [x] 2.3 (P) 推しリストパネルを整備する
  - 推しリスト概要の表示と空状態の表示を切り替える
  - 公開/非公開の判定に応じて表示可否とメッセージを切り替える
  - お気に入り登録の操作手段を表示し、状態に応じて有効/無効を切り替える
  - 読み込み中、エラー、空状態を区別して表示する
  - _Requirements: 2.1, 2.3, 2.5, 6.1, 6.2, 6.3, 6.4, 7.1, 7.2, 7.3, 7.4, 9.4_

- [ ] 2.4 (P) 推し作品一覧パネルを整備する
  - 推し作品（シリーズ）項目の表示を行い、見出しや要素のレイアウトを整える
  - 読み込み中、空状態、エラー状態を区別して表示する
  - _Requirements: 2.2, 2.4, 2.5, 5.2, 5.3, 5.4, 9.4_

- [ ] 3. ユーザーページの画面構成を実装する
- [ ] 3.1 ユーザーマイページの表示フローを実装する
  - ログイン必須の前提で認証状態を確認し、未ログイン時はログイン画面へ誘導する
  - ユーザーIDをもとにユーザー情報を取得し、存在しない場合はページ全体のエラー状態に切り替える
  - 推しリストと推し作品の取得は並行で行い、各セクションの状態を独立して扱う
  - 再試行ボタンを1つ用意し、失敗時に全セクションを再取得できるようにする
  - ページ再表示時は最新情報に更新されるようにする
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6, 1.7, 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 3.7, 3.8, 3.9, 4.1, 4.4, 6.1, 6.2, 6.3, 6.4, 7.1, 7.2, 7.3, 7.4, 7.5, 8.3, 9.1, 9.2, 9.3, 9.4_

- [ ] 3.2 推し作品一覧ページの表示フローを実装する
  - ログイン必須の前提で認証状態を確認し、未ログイン時はログイン画面へ誘導する
  - ユーザー情報と外部リンクを上部に表示し、推し作品一覧の見出しを表示する
  - 推し作品一覧の読み込み/空/エラー状態を明確に分離する
  - 再試行ボタンを1つ用意し、失敗時に再取得できるようにする
  - ページ再表示時に同一ユーザーの情報が反映されるようにする
  - _Requirements: 4.2, 4.4, 5.1, 5.2, 5.3, 5.4, 5.5, 9.1, 9.2, 9.3, 9.4_

- [ ] 4. ナビゲーションとルーティングを整備する
- [ ] 4.1 ユーザーページのルートを追加し、対象ページ以外で表示しないようにする
  - `/users/:userId/` と `/users/:userId/oshi-series/` のルートを登録する
  - 対象ページ以外ではユーザー情報・外部リンクのセクションを表示しないようにする
  - _Requirements: 4.3, 8.2_

- [ ] 4.2 みんなの推しリストからユーザーページへの導線を追加する
  - ユーザーネームからユーザーマイページへ遷移できるリンクを提供する
  - リンク先ユーザーが存在しない場合はユーザーページ側のエラー表示につながる導線を確認する
  - _Requirements: 8.1, 8.2, 8.3_

- [ ] 5. テストで主要な利用シナリオを検証する
- [ ] 5.1 プロバイダのユニットテストを整備する
  - 外部リンクのURL検証とカテゴリ分類の動作を確認する
  - 推しリストの公開/非公開/未作成の分岐とお気に入り状態の反映を確認する
  - 推し作品一覧の欠損データ除外と空状態判定を確認する
  - _Requirements: 3.3, 3.6, 3.9, 6.1, 6.2, 6.4, 7.5, 5.3, 5.4_

- [ ] 5.2 ページ統合のテストを整備する
  - ユーザーページでユーザー情報・外部リンク・推し作品が同時取得されることを確認する
  - 非公開リストでお気に入り操作が無効化されることを確認する
  - 無効な外部リンクが表示されないことを確認する
  - _Requirements: 1.1, 2.2, 3.3, 6.2, 7.3, 9.1, 9.4_

- [ ] 5.3 主要導線のE2E/UIテストを整備する
  - 未ログイン時にログイン画面へ遷移することを確認する
  - みんなの推しリストからユーザーページに遷移できることを確認する
  - 推し作品一覧ページで一覧が表示されることを確認する
  - _Requirements: 4.2, 5.1, 7.3, 8.1, 8.2_
