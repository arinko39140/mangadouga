# 実装ギャップ分析: sitewide-ui-polish-accessibility

## 分析サマリー
- UIはページ単位のCSSで構成され、色・タイポグラフィ・カード表現が分散しており、サイト全体の一貫性を保証する共通トークン/コンポーネントが不足。
- アニメーションは一部ページに限定され、`prefers-reduced-motion` への対応がなく、アクセシビリティ要件の「動きの抑制」に未対応。
- フォーカス可視化が弱く、`outline: none` によりキーボード操作の視認性が低下している箇所が存在。
- データ更新フロー（CSV/JSON）の手順ドキュメントが実質未整備で、運用要件に対するギャップが明確。

## ドキュメント状況
- 参照: `.kiro/specs/sitewide-ui-polish-accessibility/requirements.md`（未承認）
- 参照: `.kiro/steering/` 全ファイル、`.kiro/settings/rules/gap-analysis.md`
- ギャップ分析フレームワークに従って現状調査・要件適合性・選択肢評価を実施

## 1. 現状調査

### 1.1 既存アセット/構成
- グローバルスタイル: `src/index.css`（フォント、背景グラデーション、基本色）
- 共通レイアウト: `src/AppShell.jsx` + `src/AppShell.css`（ヘッダー/認証表示）
- ページ別CSS: `TopPage.css`、`OshiListsPage.css`、`UserPage.css`、`HistoryPage.css`、`LoginPage.css`、`WorkPage.css` など
- コンテンツ用スタイル: `content/assets/styles.css`（Markdown静的ページ向け、独自配色/フォント）
- アニメーション: `src/App.css` に `floatIn` / `fadeUp`、複数ページに `transition` 定義
- アクセシビリティ属性: `aria-live` / `aria-pressed` / `aria-label` が複数コンポーネントに存在

### 1.2 命名/構成パターン
- React関数コンポーネント + CSS並置（BEM風クラス）
- ページ単位で色・影・タイポグラフィ指定が分散
- デザイン・トークン（色/余白/タイポスケール）や共通ユーティリティは未整備

### 1.3 統合面
- サイト全体で利用する「カード」「ボタン」「バッジ」などの共通コンポーネントがない
- `outline: none` が複数箇所で設定され、フォーカス可視性を抑制
- `prefers-reduced-motion` への分岐なし
- データ更新手順のドキュメントは `feature_list.md` / `screen-spec.md` に記載があるのみで具体的手順が未記載

## 2. 要件適合性とギャップ

### 2.1 要件→アセット対応表（ギャップタグ）

| 要件 | 既存アセット | ギャップ |
| --- | --- | --- |
| サイト全体の視覚的一貫性（Req 1） | `src/index.css` / `AppShell.css` / 各ページCSS | Partial（共通トークン・コンポーネント不足） |
| タイポグラフィと配色の強化（Req 2） | フォント指定は存在（`index.css`/個別CSS） | Partial（統一スケール/コントラスト規定なし） |
| カード表示の強調とレイアウト（Req 3） | `TopPage.css`/`OshiListsPage.css`/`HistoryPage.css` 等 | Partial（カード表現が分散・hover/focus規則不統一） |
| アニメーションと初回ロード体験（Req 4） | `App.css` の keyframes / いくつかの transition | Partial（サイト全体に適用されていない） |
| 動き抑制対応（Req 4-4） | なし | Missing（`prefers-reduced-motion`未対応） |
| データ更新フローの整理（Req 5） | `feature_list.md`/`screen-spec.md` に短い言及 | Missing（具体的手順/エラー/チェック項目なし） |
| キーボード操作とフォーカス（Req 6） | ボタン/リンク構成は多数 | Partial（フォーカス可視化が不足、outline抑制） |
| コントラストと可視性（Req 7） | 色指定が多いが基準未定義 | Unknown/Partial（基準/監査が未実施） |

### 2.2 必要な技術要素（不足/未知）
- **デザインシステム**: 色・タイポ・余白・影のトークン化（CSS変数）
- **共通コンポーネント/ユーティリティ**: カード、ボタン、バッジ、タグ、セクション見出し
- **アクセシビリティ**: `:focus-visible` の標準化、`outline` / フォーカスリングの復活、状態変化の非色依存表現
- **動きの抑制**: `@media (prefers-reduced-motion: reduce)` でアニメーション/トランジションを軽減
- **運用ドキュメント**: CSV/JSON更新手順、入力項目・配置場所、失敗例、更新後のチェックリスト

### 2.3 制約/既存前提
- ページ単位のCSSが多数存在し、全面置換は影響範囲が広い
- `content/` 配下の静的ページは別スタイル体系で、統一デザインに合わせる場合は方針整理が必要
- TypeScriptなし・ESM/React構成を維持する必要あり

### 2.4 Research Needed（設計フェーズへ持ち越し）
- コントラスト基準（WCAG AA 相当を想定するか）と検証方法
- 代表ページにおける視認性課題の実測（色/文字サイズ/背景との関係）
- 動きの抑制対象（初回ロード/カード出現/ホバー）と許容速度
- データ更新フロー: 現行のCSV/JSONの正式な更新経路（Supabase連携/静的データの利用範囲）

## 3. 実装アプローチの選択肢

### Option A: 既存CSSの拡張（最小変更）
**方針**: `src/index.css` に色/タイポのCSS変数を追加し、主要ページのCSSを変数参照へ置換。既存クラス構造は維持。アクセシビリティは `focus-visible` の追加と `prefers-reduced-motion` のみ導入。ドキュメントはREADMEや新規MDで補完。  
**影響範囲**: `src/index.css`、主要ページCSS、ドキュメント新規追加。  
**トレードオフ**:
- ✅ 変更範囲が限定され、短期導入が容易
- ✅ 既存UIの破壊が少ない
- ❌ ページ間の表現差が残る可能性
- ❌ 中長期の整合性は弱い

### Option B: デザインシステム化（共通コンポーネント新設）
**方針**: トークン（色/タイポ/影/余白）＋共通UI（カード/ボタン/バッジ/セクション）を作成し、各ページを順次置換。アクセシビリティ基準も共通コンポーネントに集約。  
**影響範囲**: 新規UI基盤 + 各ページの改修。  
**トレードオフ**:
- ✅ 一貫性・拡張性が高い
- ✅ アクセシビリティを中央で担保できる
- ❌ 工数が増え、ページ改修が広範
- ❌ 移行フェーズの整合が必要

### Option C: ハイブリッド（トークン化 + 重点ページ優先）
**方針**: まずトークンと最低限の共通パターン（カード/ボタン）を作り、TopPage/OshiLists/WorkPage/Historyなど優先ページに適用。その他は段階移行。ドキュメントとアクセシビリティ改善は全体に横断適用。  
**影響範囲**: トークン + 共通パターン + 重点ページの改修。  
**トレードオフ**:
- ✅ リスクと工数のバランスが良い
- ✅ デザイン統一の効果が早期に見える
- ❌ 一部ページの旧スタイルが残る
- ❌ 移行完了までの運用が必要

## 4. 実装規模・リスク評価

- **Effort**: M（3〜7日）
  - CSSトークン化、主要ページ改修、アクセシビリティ修正、運用ドキュメント作成が必要。
- **Risk**: Medium
  - 影響範囲が広く、視覚差分の検証と既存UIの崩れ検知が課題。

## 5. 設計フェーズへの推奨・論点

- **推奨方針（暫定）**: Option C（ハイブリッド）
  - 一貫性向上と導入リスクのバランスを取りやすい。
- **主要論点**:
  - 全ページ統一の対象範囲（`content/` も対象に含めるか）
  - カード/ボタン/タグの共通仕様と優先順位
  - フォーカスリング・コントラストの基準値
  - `prefers-reduced-motion` の適用範囲
  - CSV/JSON更新フローの“現行手順”の実態把握

## 次のステップ

- 要件の承認状態を確認し、必要に応じて要件更新を検討
- `/prompts:kiro-spec-design sitewide-ui-polish-accessibility` を実行して design.md を作成
- アクセシビリティ基準と運用ドキュメントの位置づけを設計フェーズで明確化
